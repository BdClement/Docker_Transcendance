const translations = {
    en: {
        play: "Play",
        local_1v1: "Local 1v1",
        local_2v2: "Local 2v2",
        remote_1v1: "Remote 1v1",
        language: "Language",
        PlayerWin: "The winner is : ",
        TeamWins: "Team winning is : ",
        gameEndedUnexpectedly: "The game ended unexpectedly.",
        gameEnded: "The game has ended.",
        gameTerminated: "The game has been terminated by the server.",
        logout: "Logout",
        authButton: "Sign Up/Login",
        authModalTitle: "Authentication",
        loginTab: "Login",
        signupTab: "Sign Up",
        username: "Username",
        alias: "Alias",
        email: "Email",
        password: "Password",
        profilePhoto: "Profile Photo",
        loginButton: "Log In",
        signupButton: "Sign Up",
        friendModalTitle: "Friend Management",
        friendListTab: "Friend List",
        addFriendTab: "Add Friend",
        yourFollowing: "Your Following :",
        yourFollowers: "Your Followers :",
        addFriendUsername: "Friend's Username",
        addFriendButton: "Add",
        friendProfileTitle: "Friend's Profile",
        unfollowButton: "Unfollow",
        closeButton: "Close",
        tournamentModalTitle: "Create a Tournament",
        playerCount: "Number of Players",
        createTournament: "Create Tournament",
        playerAlias: "Player {number} Alias",
        tournamentCreationError: "An error occurred while creating the tournament",
        pleaseEnterValidAliases: "Please enter {count} valid aliases",
        playerCountOption4: "4 players",
        playerCountOption8: "8 players",
        historiqueModalTitle: "Match History",
        authRequired: "Please login to access your match history",
        date: "Date",
        gameType: "Type",
        winners: "Winners",
        losers: "Losers",
        score: "Score",
        playersCount: "{count} players",
        userModalTitle: "User Profile",
        games: "Games",
        victories: "Victories",
        defeats: "Defeats",
        username: "Username",
        alias: "Alias",
        email: "Email",
        noUserInfo: "Unavailable. You must be connected to see your profile",
        userNotFound: "User not found",
        userIdNotFound: "User ID not found",
        notificationModalTitle: "Notification",
        tournamentScoreStorageAttempt: "Attempting to store the tournament {tournamentId} score. This may take a few moments...\nYou can access on-chain data at the contract address via Etherscan: \n<a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        unexpectedTournamentError: "An unexpected error occurred during the tournament.",
        tournamentResultsError: "An error occurred while displaying the tournament results.",
        nextGameModalTitle: "Next Match",
        startNextGame: "Play",
        nextGameVs: "{player1} VS {player2}",
        noFollowers: "No followers",
        settingsModalTitle: "Update profile",
        settingsUsername: "Username",
        settingsEmail: "Email",
        settingsAlias: "Alias",
        settingsProfilePhoto: "Profile Photo",
        settingsSaveChanges: "Save Changes",
        profileUpdateSuccess: "Profile updated successfully!",
        profileUpdateError: "Failed to update profile",
        chooseFile: "Choose File",
        noFileChosen: "No file chosen",
        loginToSeeFriends: "Please log in to see your friends!",
        tournamentUnexpectedError: "An unexpected error occurred during the tournament flow.",
        tournamentStored: "The score for tournament {tournamentId} has been stored on the contract at address: <a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        errorFetchingUser: "An error occurred while fetching user information",
        loginToUpdateProfile: "Please log in to access update profile section !"
    },
    fr: {
        play: "Jouer",
        local_1v1: "Local 1c1",
        local_2v2: "Local 2c2",
        remote_1v1: "Distant 1c1",
        language: "Langue",
        PlayerWin: "Le gagnant est : ",
        TeamWins: "L'équipe gagnante est : ",
        gameEndedUnexpectedly: "La partie s'est terminée de manière inattendue.",
        gameEnded: "La partie est terminée.",
        gameTerminated: "La partie a été interrompue par le serveur.",
        logout: "Déconnexion",
        authButton: "S'inscrire/Connexion",
        authModalTitle: "Authentification",
        loginTab: "Connexion",
        signupTab: "Inscription",
        username: "Nom d'utilisateur",
        alias: "Alias",
        email: "Email",
        password: "Mot de passe",
        profilePhoto: "Photo de profil",
        loginButton: "Se connecter",
        signupButton: "S'inscrire",
        friendModalTitle: "Gestion des amis",
        friendListTab: "Liste d'amis",
        addFriendTab: "Ajouter un ami",
        yourFollowing: "Vos abonnements :",
        yourFollowers: "Vos abonnés :",
        addFriendUsername: "Nom de l'ami",
        addFriendButton: "Ajouter",
        friendProfileTitle: "Profil de l'ami",
        unfollowButton: "Se désabonner",
        closeButton: "Fermer",
        tournamentModalTitle: "Créer un tournoi",
        playerCount: "Nombre de joueurs",
        createTournament: "Créer le tournoi",
        playerAlias: "Alias du joueur {number}",
        tournamentCreationError: "Une erreur est survenue lors de la création du tournoi",
        pleaseEnterValidAliases: "Veuillez entrer {count} alias valides",
        playerCountOption4: "4 joueurs",
        playerCountOption8: "8 joueurs",
        historiqueModalTitle: "Historique des parties",
        authRequired: "Connectez-vous pour accéder à votre historique de parties",
        date: "Date",
        gameType: "Type",
        winners: "Gagnants",
        losers: "Perdants",
        score: "Score",
        playersCount: "{count}j",
        userModalTitle: "Profil Utilisateur",
        games: "Parties",
        victories: "Victoires",
        defeats: "Défaites",
        username: "Nom d'utilisateur",
        alias: "Alias",
        email: "Email",
        noUserInfo: "Indisponible. Vous devez vous connecter pour voir votre profil",
        userNotFound: "Utilisateur non trouvé",
        userIdNotFound: "ID de l'utilisateur non trouvé",
        notificationModalTitle: "Notification",
        tournamentScoreStorageAttempt: "Tentative de stockage du score du tournoi {tournamentId}. Cela peut prendre quelques instants...\nVous pouvez accéder aux données on-chain à l'adresse du contrat via Etherscan : \n<a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        unexpectedTournamentError: "Une erreur inattendue est survenue lors du tournoi.",
        tournamentResultsError: "Une erreur est survenue lors de l'affichage des résultats du tournoi.",
        nextGameModalTitle: "Prochaine partie",
        startNextGame: "Jouer",
        nextGameVs: "{player1} VS {player2}",
        noFollowers: "Aucun abonné",
        settingsModalTitle: "Mettre a jour le profil",
        settingsUsername: "Nom d'utilisateur",
        settingsEmail: "Email",
        settingsAlias: "Alias",
        settingsProfilePhoto: "Photo de profil",
        settingsSaveChanges: "Enregistrer les modifications",
        profileUpdateSuccess: "Profil mis à jour avec succès !",
        profileUpdateError: "Échec de la mise à jour du profil",
        chooseFile: "Choisir un fichier",
        noFileChosen: "Aucun fichier sélectionné",
        loginToSeeFriends: "Connectez-vous pour voir vos amis !",
        tournamentUnexpectedError: "Une erreur est survenue lors du déroulement du tournoi.",
        tournamentStored: "Le score du tournoi {tournamentId} a bien été stocké sur le contrat à l'adresse : <a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        errorFetchingUser: "Une erreur est survenue lors de la récupération des informations utilisateur",
        loginToUpdateProfile: "Connectez-vous pour acceder a la mise a jour de votre profil !"
    },
    viet: {
        play: "Chơi",
        local_1v1: "ở gần 1t1",
        local_2v2: "ở gần 2t2",
        remote_1v1: "Khoảng 1t1",
        language: "Ngôn ngữ",
        PlayerWin: "Người chiến thắng là : ",
        TeamWins: "Đội chiến thắng là : ",
        gameEndedUnexpectedly: "Trò chơi kết thúc bất ngờ.",
        gameEnded: "Trò chơi đã kết thúc.",
        gameTerminated: "Trò chơi đã bị máy chủ chấm dứt.",
        logout: "Đăng xuất",
        authButton: "Đăng ký/Đăng nhập",
        authModalTitle: "Xác thực",
        loginTab: "Đăng nhập",
        signupTab: "Đăng ký",
        username: "Tên người dùng",
        alias: "Biệt danh",
        email: "Email",
        password: "Mật khẩu",
        profilePhoto: "Ảnh hồ sơ",
        loginButton: "Đăng nhập",
        signupButton: "Đăng ký",
        friendModalTitle: "Quản lý bạn bè",
        friendListTab: "Danh sách bạn bè",
        addFriendTab: "Thêm bạn",
        yourFollowing: "Bạn đang theo dõi :",
        yourFollowers: "Người theo dõi bạn :",
        addFriendUsername: "Tên người dùng của bạn bè",
        addFriendButton: "Thêm",
        friendProfileTitle: "Hồ sơ bạn bè",
        unfollowButton: "Bỏ theo dõi",
        closeButton: "Đóng",
        tournamentModalTitle: "Tạo Giải Đấu",
        playerCount: "Số Lượng Người Chơi",
        createTournament: "Tạo Giải Đấu",
        playerAlias: "Biệt Danh Người Chơi {number}",
        tournamentCreationError: "Đã xảy ra lỗi khi tạo giải đấu",
        pleaseEnterValidAliases: "Vui lòng nhập {count} bí danh hợp lệ",
        playerCountOption4: "4 người chơi",
        playerCountOption8: "8 người chơi",
        historiqueModalTitle: "Lịch Sử Trận Đấu",
        authRequired: "Vui lòng đăng nhập để xem lịch sử trận đấu của bạn",
        date: "Ngày",
        gameType: "Loại",
        winners: "Người Thắng",
        losers: "Người Thua",
        score: "Điểm Số",
        playersCount: "{count} người",
        userModalTitle: "Hồ Sơ Người Dùng",
        games: "Trận đấu",
        victories: "Chiến thắng",
        defeats: "Thất bại",
        username: "Tên người dùng",
        alias: "Biệt danh",
        email: "Email",
        noUserInfo: "Không có thông tin người dùng",
        userNotFound: "Không tìm thấy người dùng",
        userIdNotFound: "Không tìm thấy ID người dùng",
        notificationModalTitle: "Thông báo",
        tournamentScoreStorageAttempt: "Đang thử lưu điểm giải đấu {tournamentId}. Điều này có thể mất một vài giây...\nBạn có thể truy cập dữ liệu on-chain tại địa chỉ hợp đồng qua Etherscan: \n<a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        unexpectedTournamentError: "Đã xảy ra lỗi bất ngờ trong giải đấu.",
        tournamentResultsError: "Đã xảy ra lỗi khi hiển thị kết quả giải đấu.",
        nextGameModalTitle: "Trận Tiếp Theo",
        startNextGame: "Chơi",
        nextGameVs: "{player1} VS {player2}",
        noFollowers: "Không có người theo dõi",
        settingsModalTitle: "Cài Đặt",
        settingsUsername: "Tên người dùng",
        settingsEmail: "Email",
        settingsAlias: "Biệt danh",
        settingsProfilePhoto: "Ảnh hồ sơ",
        settingsSaveChanges: "Lưu Thay Đổi",
        profileUpdateSuccess: "Cập nhật hồ sơ thành công!",
        profileUpdateError: "Không thể cập nhật hồ sơ",
        chooseFile: "Chọn Tệp",
        noFileChosen: "Chưa chọn tệp",
        loginToSeeFriends: "Vui lòng đăng nhập để xem bạn bè của bạn!",
        tournamentUnexpectedError: "Đã xảy ra lỗi bất ngờ trong quá trình diễn ra giải đấu.",
        tournamentStored: "Điểm số của giải đấu {tournamentId} đã được lưu trữ trên hợp đồng tại địa chỉ: <a href='{etherscanLink}' target='_blank'>{contractAddress}</a>",
        errorFetchingUser: "Đã xảy ra lỗi khi tải thông tin người dùng",
        loginToUpdateProfile: "Vui lòng đăng nhập để xem bạn bè của bạn!"
    }
};

const t = (key, params = {}) => {
    const lang = localStorage.getItem('language') || 'fr';
    let translation = translations[lang][key] || key;

    Object.keys(params).forEach(param => {
        translation = translation.replace(`{${param}}`, params[param]);
    });

    return translation;
};

function applyTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const paramsAttr = element.getAttribute('data-i18n-params');
        const params = paramsAttr ? JSON.parse(paramsAttr) : {};

        //Ajout pour les pseudo-elements
        const translation = t(key, params);
        if (element.tagName === 'LI') {
            element.style.setProperty('--pseudo-content', `"${translation}"`);
        } else {
            if (element.tagName === 'INPUT') {
                if (element.type === 'submit') {
                    element.value = t(key, params);
                } else if (element.type === 'file') {
                    element.setAttribute('title', t(key, params));
                }
            } else {
                element.textContent = t(key, params);
            }
        }
    });
}

function changeLanguage(language) {
    localStorage.setItem('language', language);
    applyTranslations();
}

document.addEventListener('DOMContentLoaded', () => {
    const savedLanguage = localStorage.getItem('language') || 'fr';
    document.getElementById('language').value = savedLanguage;
    applyTranslations();

    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
                applyTranslations();
            }
        });
    });

    observer.observe(document.body, { childList: true, subtree: true });
});

document.getElementById('language').addEventListener('change', function() {
    changeLanguage(this.value);
});

function updateContent(elementId, content) {
    const element = document.getElementById(elementId);
    if (element) {
        element.innerHTML = content;
        applyTranslations();
    }
}
